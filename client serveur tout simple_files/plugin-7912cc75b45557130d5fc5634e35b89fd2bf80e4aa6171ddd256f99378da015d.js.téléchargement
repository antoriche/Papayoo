!function(e,t){function o(e){e.toggleClass("open")}var s=function(e){var t,o=e.createElement("details");if(!("open"in o))return!1;var s=e.body||function(){var o=e.documentElement;return t=!0,o.insertBefore(e.createElement("body"),o.firstElementChild||o.firstChild)}();o.innerHTML="<summary>a</summary>b",o.style.display="block",s.appendChild(o);var n=o.offsetHeight;return o.open=!0,n=n!==o.offsetHeight,s.removeChild(o),t&&s.parentNode.removeChild(s),n}(e);t.fn.details=function(){return s?this:this.each(function(){var e=t(this),s=t("summary",e).first();s.prop("tabIndex",0),s.on("keydown",function(t){return 32===t.keyCode||13===t.keyCode?(o(e),!1):void 0}),s.on("click",function(){s.focus(),o(e)})})}}(document,jQuery),define("discourse/plugins/discourse-details/lib/discourse-markdown/details",["pretty-text/pretty-text","exports"],function(e,t){"use strict";function o(e,t,o){return"<details><summary>"+t+"</summary>"+o+"</details>"}function s(e){for(e=e||"";e!==(e=e.replace(/\[details=([^\]]+)\]((?:(?!\[details=[^\]]+\]|\[\/details\])[\S\s])*)\[\/details\]/gi,o)););return e.replace(/<\/summary>/gi,"</summary>\n\n").replace(/<\/details>/gi,"\n\n</details>\n\n")}function n(e){e.whiteList(["summary","summary[title]","details","details[open]","details.elided"]),e.addPreProcessor(function(e){return s(e)})}t.setup=n;var l=e.registerOption;l(function(e,t){t.features.details=!0})}),define("discourse/plugins/discourse-details/initializers/apply-details",["discourse/lib/plugin-api","exports"],function(e,t){"use strict";function o(e){e.decorateCooked(function(e){return $("details",e).details()}),e.addToolbarPopupMenuOptionsCallback(function(){return{action:"insertDetails",icon:"caret-right",label:"details.title"}});var t=e.container.lookupFactory("controller:composer");t.reopen({actions:{insertDetails:function(){this.get("toolbarEvent").applySurround("[details="+I18n.t("composer.details_title")+"]","[/details]","details_text",{multiline:!1}),this.set("optionsVisible",!1)}}})}var s=e.withPluginApi;t["default"]={name:"apply-details",initialize:function(){s("0.5",o)}}}),define("discourse/plugins/discourse-solved/discourse/pre-initializers/extend-category-for-solved",["ember-addons/ember-computed-decorators","discourse/models/category","exports"],function(e,t,o){"use strict";function s(e){for(var t={},o=0;o<e.length;o++){var s=e[o],n=s.decorators,l=s.key;if(delete s.key,delete s.decorators,s.enumerable=!0,s.configurable=!0,("value"in s||s.initializer)&&(s.writable=!0),n)for(var i=0;i<n.length;i++){var r=n[i];if("function"!=typeof r)throw new TypeError("The decorator for method "+s.key+" is of the invalid type "+typeof r);s=r(t,l,s)||s}s.initializer&&(s.value=s.initializer.call(t)),Object.defineProperty(t,l,s)}return t}var n=e["default"],l=t["default"];o["default"]={name:"extend-category-for-solved",before:"inject-discourse-objects",initialize:function(){l.reopen(s([{key:"enable_accepted_answers",decorators:[n("custom_fields.enable_accepted_answers")],initializer:function(){return{get:function(e){return"true"===e},set:function(e){return e=e?"true":"false",this.set("custom_fields.enable_accepted_answers",e),e}}}}]))}}}),Ember.TEMPLATES["javascripts/discourse/connectors/user-activity-bottom/solved-list"]=Ember.HTMLBars.template({id:null,block:'{"statements":[["block",["link-to"],["userActivity.solved"],null,0]],"locals":[],"named":[],"yields":[],"blocks":[{"statements":[["text","  "],["open-element","i",[]],["static-attr","class","glyph fa fa-check-square"],["flush-element"],["close-element"],["append",["helper",["i18n"],["solved.title"],null],false],["text","\\n"]],"locals":[]}],"hasPartials":false}',meta:{moduleName:"javascripts/discourse/connectors/user-activity-bottom/solved-list"}}),Ember.TEMPLATES["javascripts/discourse/connectors/topic-after-cooked/solved-panel"]=Ember.HTMLBars.template({id:null,block:'{"statements":[["block",["if"],[["get",["topic","accepted_answer"]]],null,0]],"locals":[],"named":[],"yields":[],"blocks":[{"statements":[["open-element","p",[]],["static-attr","class","solved"],["flush-element"],["text","\\n"],["append",["unknown",["topic","acceptedAnswerHtml"]],true],["text","\\n"],["close-element"],["text","\\n"]],"locals":[]}],"hasPartials":false}',meta:{moduleName:"javascripts/discourse/connectors/topic-after-cooked/solved-panel"}}),Ember.TEMPLATES["javascripts/discourse/connectors/user-summary-stat/solved-count"]=Ember.HTMLBars.template({id:null,block:'{"statements":[["block",["link-to"],["userActivity.solved"],null,0]],"locals":[],"named":[],"yields":[],"blocks":[{"statements":[["text","  "],["append",["helper",["user-stat"],null,[["value","label"],[["get",["model","solved_count"]],"solved.solution_summary"]]],false],["text","\\n"]],"locals":[]}],"hasPartials":false}',meta:{moduleName:"javascripts/discourse/connectors/user-summary-stat/solved-count"}}),Ember.TEMPLATES["javascripts/discourse/connectors/category-custom-settings/solved-settings"]=Ember.HTMLBars.template({id:null,block:'{"statements":[["block",["unless"],[["get",["siteSettings","allow_solved_on_all_topics"]]],null,0]],"locals":[],"named":[],"yields":[],"blocks":[{"statements":[["open-element","section",[]],["static-attr","class","field"],["flush-element"],["text","\\n  "],["open-element","div",[]],["static-attr","class","enable-accepted-answer"],["flush-element"],["text","\\n    "],["open-element","label",[]],["static-attr","class","checkbox-label"],["flush-element"],["text","\\n      "],["append",["helper",["input"],null,[["type","checked"],["checkbox",["get",["category","enable_accepted_answers"]]]]],false],["text","\\n      "],["append",["helper",["i18n"],["solved.allow_accepted_answers"],null],false],["text","\\n    "],["close-element"],["text","\\n  "],["close-element"],["text","\\n"],["close-element"],["text","\\n"]],"locals":[]}],"hasPartials":false}',meta:{moduleName:"javascripts/discourse/connectors/category-custom-settings/solved-settings"}}),define("discourse/plugins/discourse-solved/discourse/routes/user-activity-solved",["discourse/routes/user-activity-stream","exports"],function(e,t){"use strict";var o=e["default"];t["default"]=o.extend({userActionType:15,noContentHelpKey:"solved.no_solutions"})}),define("discourse/plugins/discourse-solved/discourse/solved-route-map",["exports"],function(e){"use strict";e["default"]={resource:"user.userActivity",map:function(){this.route("solved")}}}),define("discourse/plugins/discourse-solved/discourse/initializers/extend-for-solved-button",["discourse/models/topic","discourse/models/user","discourse/views/topic-status","discourse/lib/ajax-error","discourse/lib/plugin-api","discourse/lib/ajax","exports"],function(e,t,o,s,n,l,i){"use strict";function r(e){var t=e.get("postStream.posts");t.forEach(function(e){e.get("post_number")>1&&(e.set("accepted_answer",!1),e.set("can_accept_answer",!0),e.set("can_unaccept_answer",!1))})}function a(e){if(e.get("can_unaccept_answer")){var t=e.topic;e.setProperties({can_accept_answer:!0,can_unaccept_answer:!1,accepted_answer:!1}),t.set("accepted_answer",void 0),g("/solution/unaccept",{type:"POST",data:{id:e.get("id")}})["catch"](m)}}function u(e){var t=e.topic;r(t),e.setProperties({can_unaccept_answer:!0,can_accept_answer:!1,accepted_answer:!0}),t.set("accepted_answer",{username:e.get("username"),post_number:e.get("post_number")}),g("/solution/accept",{type:"POST",data:{id:e.get("id")}})["catch"](m)}function c(){var e=require("discourse/views/post")["default"];e.reopen({classNameBindings:["post.accepted_answer:accepted-answer"]});var t=require("discourse/components/post-menu"),o=t["default"],s=t.Button;o.registerButton(function(e){var t=0,o=this.get("post.can_accept_answer"),n=this.get("post.can_unaccept_answer"),l=this.get("post.accepted_answer"),i=Discourse.User.currentProp("id")===this.get("post.topic.user_id");if(!l&&o&&!i){if(this.get("collapsed"))return;t=e.length-2}if(o&&e.splice(t,0,new s("acceptAnswer","solved.accept_answer","check-square-o",{className:"unaccepted"})),n||l){var r=n?"solved.unaccept_answer":"solved.accepted_answer";e.splice(t,0,new s("unacceptAnswer",r,"check-square",{className:"accepted fade-out",prefixHTML:'<span class="accepted-text">'+I18n.t("solved.solution")+"</span>"}))}}),o.reopen({acceptedChanged:function(){this.rerender()}.observes("post.accepted_answer"),clickUnacceptAnswer:function(){a(this.get("post"))},clickAcceptAnswer:function(){u(this.get("post"))}})}function p(e){var t=e.getCurrentUser();e.includePostAttributes("can_accept_answer","can_unaccept_answer","accepted_answer"),e.addDiscoveryQueryParam&&e.addDiscoveryQueryParam("solved",{replace:!0,refreshModel:!0}),e.addPostMenuButton("solved",function(e){var o=e.can_accept_answer,s=e.can_unaccept_answer,n=e.accepted_answer,l=t&&t.id===e.topicCreatedById,i=n||!o||l?"first":"second-last-hidden";if(o)return{action:"acceptAnswer",icon:"check-square-o",className:"unaccepted",title:"solved.accept_answer",position:i};if(s||n){var r=s?"solved.unaccept_answer":"solved.accepted_answer";return{action:"unacceptAnswer",icon:"check-square",title:r,className:"accepted fade-out",position:i,beforeButton:function(e){return e("span.accepted-text",I18n.t("solved.solution"))}}}}),e.decorateWidget("post-contents:after-cooked",function(e){if(1===e.attrs.post_number){var t=e.getModel();if(t){var o=t.get("topic");if(o.get("accepted_answer"))return e.rawHtml('<p class="solved">'+o.get("acceptedAnswerHtml")+"</p>")}}}),e.attachWidgetAction("post","acceptAnswer",function(){var e=this,t=this.model,o=t.get("topic.postStream.posts").filter(function(e){return 1===e.get("post_number")||e.get("accepted_answer")});u(t),o.forEach(function(t){return e.appEvents.trigger("post-stream:refresh",{id:t.id})})}),e.attachWidgetAction("post","unacceptAnswer",function(){var e=this.model,t=e.get("topic.postStream.posts").find(function(e){return 1===e.get("post_number")});a(e),this.appEvents.trigger("post-stream:refresh",{id:t.get("id")})}),e.registerConnectorClass&&(e.registerConnectorClass("user-activity-bottom","solved-list",{shouldRender:function(e,t){return t.siteSettings.solved_enabled}}),e.registerConnectorClass("user-summary-stat","solved-count",{shouldRender:function(e,t){return t.siteSettings.solved_enabled&&e.model.solved_count>0},setupComponent:function(){this.set("classNames",["linked-stat"])}}))}var d=e["default"],f=t["default"],h=o["default"],m=s.popupAjaxError,v=n.withPluginApi,g=l.ajax;i["default"]={name:"extend-for-solved-button",initialize:function(){d.reopen({acceptedAnswerHtml:function(){var e=this.get("accepted_answer.username"),t=this.get("accepted_answer.post_number");return e&&t?I18n.t("solved.accepted_html",{username_lower:e.toLowerCase(),username:e,post_path:this.get("url")+"/"+t,post_number:t,user_path:f.create({username:e}).get("path")}):""}.property("accepted_answer","id")}),h.reopen({statuses:function(){var e=this._super();return this.topic.has_accepted_answer?e.push({openTag:"span",closeTag:"span",title:I18n.t("solved.has_accepted_answer"),icon:"check-square-o"}):this.topic.can_have_answer&&this.siteSettings.solved_enabled&&this.siteSettings.empty_box_on_unsolved&&e.push({openTag:"span",closeTag:"span",title:I18n.t("solved.has_no_accepted_answer"),icon:"square-o"}),e}.property()}),v("0.1",p,{noApi:c})}}}),function(e){function t(t){e("div.lazyYT",t).each(function(){e(this).replaceWith("<p>https://youtube.com/watch?v="+e(this).data("youtube-id")+"</p>")})}function o(e,t){var o="gray 0 0 "+t+"px",s="-webkit-user-select";l&&(o=0>=t?"0 0 0 0 gray":"0 0 "+t+"px .1px gray",s="-ms-user-select"),i&&(s="-moz-user-select"),e.css("background-color","transparent").css("color","rgba(0,0,0,0)").css("text-shadow",o).css(s,"none")}function s(t,o){e("a,pre",t).each(function(t,s){var n=o>0?"blur("+o+"px)":"";l?e(s).css("-ms-filter","progid:DXImageTransform.Microsoft.Blur(pixelradius="+o+")"):e(s).css("filter",n).css("-webkit-filter",n)})}function n(t,o){e("img",t).each(function(t,s){var n=e(this).hasClass("emoji"),l=function(){var t=n?20:s.width,l=n?20:s.height,i=++r,a="<svg data-spoiler-id='"+i+"' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink' width='"+t+"' height='"+l+"'><defs><filter id='blur-"+i+"'><feGaussianBlur id='gaussian-"+i+"' stdDeviation='"+o+"'></feGaussianBlur></filter></defs><image xlink:href='"+s.src+"' filter='url(#blur-"+i+")' style='filter: url(#blur-"+i+")' width='"+t+"' height='"+l+"'></image></svg>";e(s).replaceWith(a)};0===s.naturalWidth||0===s.naturalHeight?s.onload=l:l()}),e("svg",t).each(function(e,t){var s=t.getAttribute("data-spoiler-id"),n=t.getElementById("gaussian-"+s);n&&n.setAttribute("stdDeviation",o)})}var l=document.documentMode,i="undefined"!=typeof InstallTrigger,r=0,a={max:{text:10,link:10,image:20},partial:{text:5,link:5,image:6},none:{text:0,link:0,image:0}},u=function(e,l){t(e),o(e,l.text),s(e,l.link),n(e,l.image)},c=function(e,t){var o=t.max,s=t.partial,n=t.none;e.data("spoiler-state","blurred"),u(e,o),e.on("mouseover",function(){e.css("cursor","pointer"),"blurred"===e.data("spoiler-state")&&u(e,s)}).on("mouseout",function(){"blurred"===e.data("spoiler-state")&&u(e,o)}).on("click",function(t){"blurred"===e.data("spoiler-state")?(e.data("spoiler-state","revealed").css("cursor","auto"),u(e,n)):(e.data("spoiler-state","blurred").css("cursor","pointer"),u(e,s)),t.preventDefault()})};e.fn.spoil=function(t){var o=e.extend(a,t||{});return this.each(function(){c(e(this),o)})}}(jQuery),function(){function e(e,t){var s=o.test(t)?"div":"span";return"<"+s+" class='spoiler'>"+t+"</"+s+">"}function t(t){for(t=t||"";t!==(t=t.replace(/\[spoiler\]((?:(?!\[spoiler\]|\[\/spoiler\])[\S\s])*)\[\/spoiler\]/gi,e)););return t}if(!Discourse.dialect_deprecated){var o=/\n|<img|!\[[^\]]*\][(\[]/;Discourse.Dialect.addPreProcessor(function(e){return Discourse.SiteSettings.spoiler_enabled&&(e=t(e)),e}),Discourse.Markdown.whiteListTag("span","class","spoiler"),Discourse.Markdown.whiteListTag("div","class","spoiler")}}(),define("discourse/plugins/Spoiler Alert!/lib/discourse-markdown/spoiler-alert",["pretty-text/pretty-text","exports"],function(e,t){"use strict";function o(e,t){var o=i.test(t)?"div":"span";return"<"+o+" class='spoiler'>"+t+"</"+o+">"}function s(e){for(e=e||"";e!==(e=e.replace(/\[spoiler\]((?:(?!\[spoiler\]|\[\/spoiler\])[\S\s])*)\[\/spoiler\]/gi,o)););return e}function n(e){e.whiteList(["span.spoiler","div.spoiler"]),e.addPreProcessor(s)}t.setup=n;var l=e.registerOption;l(function(e,t){t.features["spoiler-alert"]=!!e.spoiler_enabled});var i=/\n|<img|!\[[^\]]*\][(\[]/}),define("discourse/plugins/Spoiler Alert!/initializers/spoiler-alert",["discourse/lib/plugin-api","discourse/controllers/composer","exports"],function(e,t,o){"use strict";function s(e){$(".spoiler",e).removeClass("spoiler").addClass("spoiled").spoil()}function n(e){e.decorateCooked(s),e.addToolbarPopupMenuOptionsCallback(function(){return{action:"insertSpoiler",icon:"magic",label:"spoiler.title"}}),r.reopen({actions:{insertSpoiler:function(){this.get("toolbarEvent").applySurround("[spoiler]","[/spoiler]","spoiler_text",{multiline:!1})}}})}var l=e.withPluginApi,i=e.decorateCooked,r=t["default"];o["default"]={name:"apply-spoilers",initialize:function(e){var t=e.lookup("site-settings:main");t.spoiler_enabled&&l("0.5",n,{noApi:function(){return i(e,s)}})}}}),function(e){"use strict";function t(e,t){var o,s,n,l=e.data("width"),i=e.data("height"),r=e.data("ratio")?e.data("ratio"):t.default_ratio,a=e.data("youtube-id"),u=e.data("youtube-title"),c=[],p=e.data("parameters")||"";r=r.split(":"),"number"==typeof l&&"number"==typeof i?(e.width(l),o=i+"px"):"number"==typeof l?(e.width(l),o=l*r[1]/r[0]+"px"):(l=e.width(),0===l&&(l=e.parent().width()),o=r[1]/r[0]*100+"%"),c.push('<div class="ytp-thumbnail">'),c.push('<div class="ytp-large-play-button"'),640>=l&&c.push(' style="transform: scale(0.563888888888889);"'),c.push(">"),c.push("<svg>"),c.push('<path fill-rule="evenodd" clip-rule="evenodd" fill="#1F1F1F" class="ytp-large-play-button-svg" d="M84.15,26.4v6.35c0,2.833-0.15,5.967-0.45,9.4c-0.133,1.7-0.267,3.117-0.4,4.25l-0.15,0.95c-0.167,0.767-0.367,1.517-0.6,2.25c-0.667,2.367-1.533,4.083-2.6,5.15c-1.367,1.4-2.967,2.383-4.8,2.95c-0.633,0.2-1.316,0.333-2.05,0.4c-0.767,0.1-1.3,0.167-1.6,0.2c-4.9,0.367-11.283,0.617-19.15,0.75c-2.434,0.034-4.883,0.067-7.35,0.1h-2.95C38.417,59.117,34.5,59.067,30.3,59c-8.433-0.167-14.05-0.383-16.85-0.65c-0.067-0.033-0.667-0.117-1.8-0.25c-0.9-0.133-1.683-0.283-2.35-0.45c-2.066-0.533-3.783-1.5-5.15-2.9c-1.033-1.067-1.9-2.783-2.6-5.15C1.317,48.867,1.133,48.117,1,47.35L0.8,46.4c-0.133-1.133-0.267-2.55-0.4-4.25C0.133,38.717,0,35.583,0,32.75V26.4c0-2.833,0.133-5.95,0.4-9.35l0.4-4.25c0.167-0.966,0.417-2.05,0.75-3.25c0.7-2.333,1.567-4.033,2.6-5.1c1.367-1.434,2.967-2.434,4.8-3c0.633-0.167,1.333-0.3,2.1-0.4c0.4-0.066,0.917-0.133,1.55-0.2c4.9-0.333,11.283-0.567,19.15-0.7C35.65,0.05,39.083,0,42.05,0L45,0.05c2.467,0,4.933,0.034,7.4,0.1c7.833,0.133,14.2,0.367,19.1,0.7c0.3,0.033,0.833,0.1,1.6,0.2c0.733,0.1,1.417,0.233,2.05,0.4c1.833,0.566,3.434,1.566,4.8,3c1.066,1.066,1.933,2.767,2.6,5.1c0.367,1.2,0.617,2.284,0.75,3.25l0.4,4.25C84,20.45,84.15,23.567,84.15,26.4z M33.3,41.4L56,29.6L33.3,17.75V41.4z"></path>'),c.push('<polygon fill-rule="evenodd" clip-rule="evenodd" fill="#FFFFFF" points="33.3,41.4 33.3,17.75 56,29.6"></polygon>'),c.push("</svg>"),c.push("</div>"),c.push("</div>"),c.push('<div class="html5-info-bar">'),c.push('<div class="html5-title">'),c.push('<div class="html5-title-text-wrapper">'),c.push('<a class="html5-title-text" target="_blank" tabindex="3100" href="https://www.youtube.com/watch?v=',a,'">'),void 0===u||null===u||""===u?c.push("youtube.com/watch?v="+a):c.push(u),c.push("</a>"),c.push("</div>"),c.push("</div>"),c.push("</div>"),e.css({"padding-bottom":o}).html(c.join("")),n=l>640?"maxresdefault.jpg":l>480?"sddefault.jpg":l>320?"hqdefault.jpg":l>120?"mqdefault.jpg":0===l?"hqdefault.jpg":"default.jpg",s=e.find(".ytp-thumbnail").css({"background-image":["url(//img.youtube.com/vi/",a,"/",n,")"].join("")}).addClass("lazyYT-image-loaded").on("click",function(o){o.preventDefault(),!e.hasClass("lazyYT-video-loaded")&&s.hasClass("lazyYT-image-loaded")&&e.html('<iframe src="//www.youtube.com/embed/'+a+"?autoplay=1&"+p+'" frameborder="0" allowfullscreen></iframe>').addClass("lazyYT-video-loaded"),t.onPlay&&t.onPlay(o,e)})}e.fn.lazyYT=function(o){var s={default_ratio:"16:9",callback:null,container_class:"lazyYT-container"},n=e.extend(s,o);return this.each(function(){var o=e(this).addClass(n.container_class);t(o,n)})}}(jQuery),function(e){e.fn.iframeTracker=function(t){var o=this.get();if(null===t||t===!1)e.iframeTracker.untrack(o);else{if("object"!=typeof t)throw new Error("Wrong handler type (must be an object, or null|false to untrack)");e.iframeTracker.track(o,t)}},e.iframeTracker={focusRetriever:null,focusRetrieved:!1,handlersList:[],isIE8AndOlder:!1,init:function(){try{1==e.browser.msie&&e.browser.version<9&&(this.isIE8AndOlder=!0)}catch(t){try{var o=navigator.userAgent.match(/(msie) ([\w.]+)/i);o[2]<9&&(this.isIE8AndOlder=!0)}catch(s){}}if(e(window).focus(),e(window).blur(function(t){e.iframeTracker.windowLoseFocus(t)}),e("body").append('<div style="position:fixed; top:0; left:0; overflow:hidden;"><input style="position:absolute; left:-300px;" type="text" value="" id="focus_retriever" readonly="true" /></div>'),this.focusRetriever=e("#focus_retriever"),this.focusRetrieved=!1,e(document).mousemove(function(t){document.activeElement&&"IFRAME"==document.activeElement.tagName&&(e.iframeTracker.focusRetriever.focus(),e.iframeTracker.focusRetrieved=!0)}),this.isIE8AndOlder){this.focusRetriever.blur(function(t){t.stopPropagation(),t.preventDefault(),e.iframeTracker.windowLoseFocus(t)}),e("body").click(function(t){e(window).focus()}),e("form").click(function(e){e.stopPropagation()});try{e("body").on("click","form",function(e){e.stopPropagation()})}catch(t){console.log("[iframeTracker] Please update jQuery to 1.7 or newer. (exception: "+t.message+")")}}},track:function(t,o){o.target=t,e.iframeTracker.handlersList.push(o),e(t).bind("mouseover",{handler:o},e.iframeTracker.mouseoverListener).bind("mouseout",{handler:o},e.iframeTracker.mouseoutListener)},untrack:function(t){if("function"!=typeof Array.prototype.filter)return void console.log("Your browser doesn't support Array filter, untrack disabled");e(t).each(function(t){e(this).unbind("mouseover",e.iframeTracker.mouseoverListener).unbind("mouseout",e.iframeTracker.mouseoutListener)});var o=function(e){return null!==e};for(var s in this.handlersList){for(var n in this.handlersList[s].target)-1!==e.inArray(this.handlersList[s].target[n],t)&&(this.handlersList[s].target[n]=null);this.handlersList[s].target=this.handlersList[s].target.filter(o),0==this.handlersList[s].target.length&&(this.handlersList[s]=null)}this.handlersList=this.handlersList.filter(o)},mouseoverListener:function(e){e.data.handler.over=!0;try{e.data.handler.overCallback(this)}catch(t){}},mouseoutListener:function(t){t.data.handler.over=!1,e.iframeTracker.focusRetriever.focus();try{t.data.handler.outCallback(this)}catch(o){}},windowLoseFocus:function(e){for(var t in this.handlersList)if(1==this.handlersList[t].over)try{this.handlersList[t].blurCallback()}catch(o){}}},e(document).ready(function(){e.iframeTracker.init()})}(jQuery),define("discourse/plugins/lazyYT/initializers/lazyYT",["discourse/lib/plugin-api","exports"],function(e,t){"use strict";var o=e.withPluginApi,s=function(){return!1};t["default"]={name:"apply-lazyYT",initialize:function(){o("0.1",function(e){e.decorateCooked(function(t){var o=$(".lazyYT",t);0!==o.length&&$(".lazyYT",t).lazyYT({onPlay:function(t,n){var l=parseInt(n.closest("article").data("post-id"));l&&e.preventCloak(l),$("iframe",o).iframeTracker({blurCallback:function(){$(document).on("scroll.discourse-youtube",s),window.setTimeout(function(){return $(document).off("scroll.discourse-youtube",s)},1500),$(document).scroll()}})}})})})}}}),define("discourse/plugins/poll/lib/even-round",["exports"],function(e){"use strict";function t(e){return 100===e.map(function(e){return Math.floor(e)}).reduce(function(e,t){return e+t})}e["default"]=function(e){for(var o=e.map(function(e){return e%1}),s=Math.ceil(o.reduce(function(e,t){return e+t})),n=0,l=o.length;s>n&&l>n;n++){for(var i=0,r=0,a=0;a<o.length;a++)o[a]>i&&(r=a,i=o[a]);if(++e[r],o[r]=0,t(e))break}return e.map(function(e){return Math.floor(e)})}}),define("discourse/plugins/poll/lib/discourse-markdown/poll",["pretty-text/pretty-text","exports"],function(e,t){"use strict";function o(e){e.whiteList(["div.poll","div.poll-info","div.poll-container","div.poll-buttons","div[data-*]","span.info-number","span.info-text","a.button.cast-votes","a.button.toggle-results","li[data-*]"]),e.replaceBlock({start:/\[poll((?:\s+\w+=[^\s\]]+)*)\]([\s\S]*)/gim,stop:/\[\/poll\]/gim,emitter:function(t,o){var s=this,n=[];if(t.length)for(var l=function(e){if("string"==typeof e||e instanceof String){var t=s.processInline(String(e));t.length&&n.push(["p"].concat(t))}else n.push(e)},i=void 0;void 0!==(i=t.shift());)this.processBlock(i,t).forEach(l);var r={"class":"poll"};r[g+"status"]="open",r[g+"name"]=b,(o[1].match(_)||[]).forEach(function(t){var o=t.split("="),s=m(o,2),n=s[0],l=s[1],i=e.escape(l.replace(/["']/g,""));r[g+n]=i});var a=parseInt(r[g+"min"],10),u=parseInt(r[g+"max"],10),c=parseInt(r[g+"step"],10);if("number"===r[g+"type"]){isNaN(a)&&(a=1),isNaN(u)&&(u=e.getOptions().pollMaximumOptions),isNaN(c)&&(c=1),n.push(["bulletlist"]);for(var p=a;u>=p;p+=c)n[0].push(["listitem",String(p)])}if(1!==n.length||n[0].length<=1||"numberlist"!==n[0][0]&&"bulletlist"!==n[0][0])return["div"].concat(n);for(var p=1;p<n[0].length;p++)if("listitem"!==n[0][p][0])return["div"].concat(n);for(var p=1;p<n[0].length;p++){var d={};d[g+"option-id"]=h(JSON.stringify(n[0][p].slice(1))),n[0][p].splice(1,0,d)}var f=["div",r],v=["div"],y=["div",{"class":"poll-container"}].concat(n);v.push(y);var w=["div",{"class":"poll-info"}];if(w.push(["p",["span",{"class":"info-number"},"0"],["span",{"class":"info-text"},I18n.t("poll.voters",{count:0})]]),"multiple"===r[g+"type"]){var x=n[0].length-1;(isNaN(a)||1>a)&&(a=1),(isNaN(u)||u>x)&&(u=x);var k=void 0;u>0&&(a===u?a>1&&(k=I18n.t("poll.multiple.help.x_options",{count:a})):a>1?k=x>u?I18n.t("poll.multiple.help.between_min_and_max_options",{min:a,max:u}):I18n.t("poll.multiple.help.at_least_min_options",{count:a}):x>=u&&(k=I18n.t("poll.multiple.help.up_to_max_options",{count:u}))),k&&w.push(["p",k])}"true"===r[g+"public"]&&w.push(["p",I18n.t("poll.public.title")]),v.push(w);var T=["div",{"class":"poll-buttons"}];return"multiple"===r[g+"type"]&&T.push(["a",{"class":"button cast-votes",title:I18n.t("poll.cast-votes.title")},I18n.t("poll.cast-votes.label")]),T.push(["a",{"class":"button toggle-results",title:I18n.t("poll.show-results.title")},I18n.t("poll.show-results.label")]),f.push(v),f.push(T),f}})}function s(e,t){var o=e[0],s=e[1],n=e[2],u=e[3];o=l(o,s,n,u,t[0],7,-680876936),u=l(u,o,s,n,t[1],12,-389564586),n=l(n,u,o,s,t[2],17,606105819),s=l(s,n,u,o,t[3],22,-1044525330),o=l(o,s,n,u,t[4],7,-176418897),u=l(u,o,s,n,t[5],12,1200080426),n=l(n,u,o,s,t[6],17,-1473231341),s=l(s,n,u,o,t[7],22,-45705983),o=l(o,s,n,u,t[8],7,1770035416),u=l(u,o,s,n,t[9],12,-1958414417),n=l(n,u,o,s,t[10],17,-42063),s=l(s,n,u,o,t[11],22,-1990404162),o=l(o,s,n,u,t[12],7,1804603682),u=l(u,o,s,n,t[13],12,-40341101),n=l(n,u,o,s,t[14],17,-1502002290),s=l(s,n,u,o,t[15],22,1236535329),o=i(o,s,n,u,t[1],5,-165796510),u=i(u,o,s,n,t[6],9,-1069501632),n=i(n,u,o,s,t[11],14,643717713),s=i(s,n,u,o,t[0],20,-373897302),o=i(o,s,n,u,t[5],5,-701558691),u=i(u,o,s,n,t[10],9,38016083),n=i(n,u,o,s,t[15],14,-660478335),s=i(s,n,u,o,t[4],20,-405537848),o=i(o,s,n,u,t[9],5,568446438),u=i(u,o,s,n,t[14],9,-1019803690),n=i(n,u,o,s,t[3],14,-187363961),s=i(s,n,u,o,t[8],20,1163531501),o=i(o,s,n,u,t[13],5,-1444681467),u=i(u,o,s,n,t[2],9,-51403784),n=i(n,u,o,s,t[7],14,1735328473),s=i(s,n,u,o,t[12],20,-1926607734),o=r(o,s,n,u,t[5],4,-378558),u=r(u,o,s,n,t[8],11,-2022574463),n=r(n,u,o,s,t[11],16,1839030562),s=r(s,n,u,o,t[14],23,-35309556),o=r(o,s,n,u,t[1],4,-1530992060),u=r(u,o,s,n,t[4],11,1272893353),n=r(n,u,o,s,t[7],16,-155497632),s=r(s,n,u,o,t[10],23,-1094730640),o=r(o,s,n,u,t[13],4,681279174),u=r(u,o,s,n,t[0],11,-358537222),n=r(n,u,o,s,t[3],16,-722521979),s=r(s,n,u,o,t[6],23,76029189),o=r(o,s,n,u,t[9],4,-640364487),u=r(u,o,s,n,t[12],11,-421815835),n=r(n,u,o,s,t[15],16,530742520),s=r(s,n,u,o,t[2],23,-995338651),o=a(o,s,n,u,t[0],6,-198630844),u=a(u,o,s,n,t[7],10,1126891415),n=a(n,u,o,s,t[14],15,-1416354905),s=a(s,n,u,o,t[5],21,-57434055),o=a(o,s,n,u,t[12],6,1700485571),u=a(u,o,s,n,t[3],10,-1894986606),n=a(n,u,o,s,t[10],15,-1051523),s=a(s,n,u,o,t[1],21,-2054922799),o=a(o,s,n,u,t[8],6,1873313359),u=a(u,o,s,n,t[15],10,-30611744),n=a(n,u,o,s,t[6],15,-1560198380),s=a(s,n,u,o,t[13],21,1309151649),o=a(o,s,n,u,t[4],6,-145523070),u=a(u,o,s,n,t[11],10,-1120210379),n=a(n,u,o,s,t[2],15,718787259),s=a(s,n,u,o,t[9],21,-343485551),e[0]=f(o,e[0]),e[1]=f(s,e[1]),e[2]=f(n,e[2]),e[3]=f(u,e[3])}function n(e,t,o,s,n,l){return t=f(f(t,e),f(s,l)),f(t<<n|t>>>32-n,o)}function l(e,t,o,s,l,i,r){return n(t&o|~t&s,e,t,l,i,r)}function i(e,t,o,s,l,i,r){return n(t&s|o&~s,e,t,l,i,r)}function r(e,t,o,s,l,i,r){return n(t^o^s,e,t,l,i,r)}function a(e,t,o,s,l,i,r){return n(o^(t|~s),e,t,l,i,r)}function u(e){/[\x80-\xFF]/.test(e)&&(e=unescape(encodeURI(e)));var t,o=e.length,n=[1732584193,-271733879,-1732584194,271733878];for(t=64;t<=e.length;t+=64)s(n,c(e.substring(t-64,t)));e=e.substring(t-64);var l=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];for(t=0;t<e.length;t++)l[t>>2]|=e.charCodeAt(t)<<(t%4<<3);if(l[t>>2]|=128<<(t%4<<3),t>55)for(s(n,l),t=0;16>t;t++)l[t]=0;return l[14]=8*o,s(n,l),n}function c(e){var t,o=[];for(t=0;64>t;t+=4)o[t>>2]=e.charCodeAt(t)+(e.charCodeAt(t+1)<<8)+(e.charCodeAt(t+2)<<16)+(e.charCodeAt(t+3)<<24);return o}function p(e){for(var t="",o=0;4>o;o++)t+=w[e>>8*o+4&15]+w[e>>8*o&15];return t}function d(e){for(var t=0;t<e.length;t++)e[t]=p(e[t]);return e.join("")}function f(e,t){return e+t&4294967295}function h(e){return d(u(e))}var m=function(){function e(e,t){var o=[],s=!0,n=!1,l=void 0;try{for(var i,r=e[Symbol.iterator]();!(s=(i=r.next()).done)&&(o.push(i.value),!t||o.length!==t);s=!0);}catch(a){n=!0,l=a}finally{try{!s&&r["return"]&&r["return"]()}finally{if(n)throw l}}return o}return function(t,o){if(Array.isArray(t))return t;if(Symbol.iterator in Object(t))return e(t,o);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}();t.setup=o;var v=e.registerOption,g="data-poll-",b="poll",y=["type","name","min","max","step","order","status","public"],_=new RegExp("("+y.join("|")+")=['\"]?[^\\s\\]]+['\"]?","g");v(function(e,t){var o=t.getCurrentUser&&t.getCurrentUser(t.userId)||t.currentUser,s=o&&o.staff;t.features.poll=!!e.poll_enabled||s,t.pollMaximumOptions=e.poll_maximum_options});var w="0123456789abcdef".split("")}),Ember.TEMPLATES["javascripts/modal/poll-ui-builder"]=Ember.HTMLBars.template({id:null,block:'{"statements":[["block",["d-modal-body"],null,[["title","class"],["poll.ui_builder.title","poll-ui-builder"]],3],["text","\\n"],["open-element","div",[]],["static-attr","class","modal-footer"],["flush-element"],["text","\\n  "],["append",["helper",["d-button"],null,[["action","icon","class","label","disabled"],["insertPoll","bar-chart-o","btn-primary","poll.ui_builder.insert",["get",["disableInsert"]]]]],false],["text","\\n"],["close-element"],["text","\\n"]],"locals":[],"named":[],"yields":[],"blocks":[{"statements":[["text","      "],["open-element","div",[]],["static-attr","class","input-group"],["flush-element"],["text","\\n        "],["open-element","label",[]],["flush-element"],["append",["helper",["i18n"],["poll.ui_builder.poll_options.label"],null],false],["close-element"],["text","\\n        "],["append",["helper",["input-tip"],null,[["validation"],[["get",["minNumOfOptionsValidation"]]]]],false],["text","\\n        "],["append",["helper",["textarea"],null,[["value"],[["get",["pollOptions"]]]]],false],["text","\\n      "],["close-element"],["text","\\n"]],"locals":[]},{"statements":[["text","        "],["open-element","div",[]],["static-attr","class","input-group"],["flush-element"],["text","\\n          "],["open-element","label",[]],["static-attr","class","input-group-label"],["flush-element"],["append",["helper",["i18n"],["poll.ui_builder.poll_config.step"],null],false],["close-element"],["text","\\n          "],["append",["helper",["combo-box"],null,[["content","value","valueAttribute","class"],[["get",["pollStepOptions"]],["get",["pollStep"]],"value","poll-options-step"]]],false],["text","\\n        "],["close-element"],["text","\\n"]],"locals":[]},{"statements":[["text","      "],["open-element","div",[]],["static-attr","class","input-group"],["flush-element"],["text","\\n        "],["open-element","label",[]],["static-attr","class","input-group-label"],["flush-element"],["append",["helper",["i18n"],["poll.ui_builder.poll_config.min"],null],false],["close-element"],["text","\\n        "],["append",["helper",["combo-box"],null,[["content","value","valueAttribute","class"],[["get",["pollMinOptions"]],["get",["pollMin"]],"value","poll-options-min"]]],false],["text","\\n      "],["close-element"],["text","\\n\\n\\n      "],["open-element","div",[]],["static-attr","class","input-group"],["flush-element"],["text","\\n        "],["open-element","label",[]],["static-attr","class","input-group-label"],["flush-element"],["append",["helper",["i18n"],["poll.ui_builder.poll_config.max"],null],false],["close-element"],["text","\\n        "],["append",["helper",["combo-box"],null,[["content","value","valueAttribute","class"],[["get",["pollMaxOptions"]],["get",["pollMax"]],"value","poll-options-max"]]],false],["text","\\n      "],["close-element"],["text","\\n\\n"],["block",["if"],[["get",["isNumber"]]],null,1]],"locals":[]},{"statements":[["text","  "],["open-element","form",[]],["static-attr","class","poll-ui-builder-form form-horizontal"],["flush-element"],["text","\\n    "],["open-element","div",[]],["static-attr","class","input-group"],["flush-element"],["text","\\n      "],["open-element","label",[]],["static-attr","class","input-group-label"],["flush-element"],["append",["helper",["i18n"],["poll.ui_builder.poll_type.label"],null],false],["close-element"],["text","\\n      "],["append",["helper",["combo-box"],null,[["content","value","valueAttribute","none"],[["get",["pollTypes"]],["get",["pollType"]],"value","poll.ui_builder.poll_type.regular"]]],false],["text","\\n    "],["close-element"],["text","\\n\\n"],["block",["if"],[["get",["showMinMax"]]],null,2],["text","\\n    "],["open-element","div",[]],["static-attr","class","input-group"],["flush-element"],["text","\\n      "],["open-element","label",[]],["flush-element"],["text","\\n        "],["append",["helper",["input"],null,[["type","checked"],["checkbox",["get",["publicPoll"]]]]],false],["text","\\n        "],["append",["helper",["i18n"],["poll.ui_builder.poll_public.label"],null],false],["text","\\n      "],["close-element"],["text","\\n    "],["close-element"],["text","\\n\\n"],["block",["unless"],[["get",["isNumber"]]],null,0],["text","  "],["close-element"],["text","\\n"]],"locals":[]}],"hasPartials":false}',
meta:{moduleName:"javascripts/modal/poll-ui-builder"}}),define("discourse/plugins/poll/controllers/poll-ui-builder",["ember-addons/ember-computed-decorators","discourse/models/input-validation","exports"],function(e,t,o){"use strict";function s(e){for(var t={},o=0;o<e.length;o++){var s=e[o],n=s.decorators,l=s.key;if(delete s.key,delete s.decorators,s.enumerable=!0,s.configurable=!0,("value"in s||s.initializer)&&(s.writable=!0),n)for(var i=0;i<n.length;i++){var r=n[i];if("function"!=typeof r)throw new TypeError("The decorator for method "+s.key+" is of the invalid type "+typeof r);s=r(t,l,s)||s}s.initializer&&(s.value=s.initializer.call(t)),Object.defineProperty(t,l,s)}return t}var n=e["default"],l=e.observes,i=t["default"];o["default"]=Ember.Controller.extend(s([{key:"numberPollType",initializer:function(){return"number"}},{key:"multiplePollType",initializer:function(){return"multiple"}},{key:"init",value:function(){this._super(),this._setupPoll()}},{key:"pollTypes",decorators:[n("numberPollType","multiplePollType")],value:function(e,t){var o=[];return o.push({name:I18n.t("poll.ui_builder.poll_type.number"),value:e}),o.push({name:I18n.t("poll.ui_builder.poll_type.multiple"),value:t}),o}},{key:"isMultiple",decorators:[n("pollType","pollOptionsCount","multiplePollType")],value:function(e,t,o){return e===o&&t>0}},{key:"isNumber",decorators:[n("pollType","numberPollType")],value:function(e,t){return e===t}},{key:"showMinMax",decorators:[n("isNumber","isMultiple")],value:function(e,t){return e||t}},{key:"pollOptionsCount",decorators:[n("pollOptions")],value:function(e){if(0===e.length)return 0;var t=0;return e.split("\n").forEach(function(e){0!==e.length&&(t+=1)}),t}},{key:"_setPollMax",decorators:[l("isMultiple","isNumber","pollOptionsCount")],value:function(){var e=this.get("isMultiple"),t=this.get("isNumber");(e||t)&&(e?this.set("pollMax",this.get("pollOptionsCount")):t&&this.set("pollMax",this.siteSettings.poll_maximum_options))}},{key:"pollMinOptions",decorators:[n("isMultiple","isNumber","pollOptionsCount")],value:function(e,t,o){return e||t?e?this._comboboxOptions(1,o+1):t?this._comboboxOptions(1,this.siteSettings.poll_maximum_options+1):void 0:void 0}},{key:"pollMaxOptions",decorators:[n("isMultiple","isNumber","pollOptionsCount","pollMin","pollStep")],value:function(e,t,o,s,n){if(e||t){var l=parseInt(s)||1;if(e)return this._comboboxOptions(l+1,o+1);if(t){var i=parseInt(n)||1;return this._comboboxOptions(l+1,l+this.siteSettings.poll_maximum_options*i)}}}},{key:"pollStepOptions",decorators:[n("isNumber","pollMax")],value:function(e,t){return e?this._comboboxOptions(1,(parseInt(t)||1)+1):void 0}},{key:"pollOutput",decorators:[n("isNumber","showMinMax","pollType","publicPoll","pollOptions","pollMin","pollMax","pollStep")],value:function(e,t,o,s,n,l,i,r){var a="[poll",u="",c=this.get("toolbarEvent").getText().match(/\[poll(\s+name=[^\s\]]+)*.*\]/gim);return c&&(a+=" name=poll"+(c.length+1)),o&&(a+=" type="+o),l&&t&&(a+=" min="+l),i&&(a+=" max="+i),e&&(a+=" step="+r),s&&(a+=" public=true"),a+="]",u+=a+"\n",n.length>0&&!e&&n.split("\n").forEach(function(e){0!==e.length&&(u+="* "+e+"\n")}),u+="[/poll]"}},{key:"disableInsert",decorators:[n("pollOptionsCount","isNumber")],value:function(e,t){return t?!1:2>e}},{key:"minNumOfOptionsValidation",decorators:[n("disableInsert")],value:function(e){var t={ok:!0};return e&&(t={failed:!0,reason:I18n.t("poll.ui_builder.help.options_count")}),i.create(t)}},{key:"_comboboxOptions",value:function(e,t){return _.range(e,t).map(function(e){return{value:e,name:e}})}},{key:"_setupPoll",value:function(){this.setProperties({pollType:null,publicPoll:!1,pollOptions:"",pollMin:1,pollMax:null,pollStep:1})}},{key:"actions",initializer:function(){return{insertPoll:function(){this.get("toolbarEvent").addText(this.get("pollOutput")),this.send("closeModal"),this._setupPoll()}}}}]))}),define("discourse/plugins/poll/widgets/discourse-poll",["discourse/widgets/widget","virtual-dom","discourse/helpers/fa-icon-node","discourse/widgets/raw-html","discourse/lib/ajax","discourse/plugins/poll/lib/even-round","discourse/widgets/post","discourse/lib/round","exports"],function(e,t,o,s,n,l,i,r,a){"use strict";function u(e){if(Array.isArray(e)){for(var t=0,o=Array(e.length);t<e.length;t++)o[t]=e[t];return o}return Array.from(e)}function c(e){return new h({html:"<span>"+e.html+"</span>"})}var p=e.createWidget,d=t.h,f=o.iconNode,h=s["default"],m=n.ajax,v=l["default"],g=i.avatarFor,b=r["default"];p("discourse-poll-option",{tagName:"li",buildAttributes:function(e){return{"data-poll-option-id":e.option.id}},html:function(e){var t=[],o=e.option,s=e.vote,n=-1!==s.indexOf(o.id);return e.isMultiple?t.push(f(n?"check-square-o":"square-o")):t.push(f(n?"dot-circle-o":"circle-o")),t.push(" "),t.push(c(o)),t},click:function(e){0===$(e.target).closest("a").length&&this.sendWidgetAction("toggleOption",this.attrs.option)}}),p("discourse-poll-load-more",{tagName:"div.poll-voters-toggle-expand",buildKey:function(e){return e.id+"-load-more"},defaultState:function(){return{loading:!1}},html:function(e,t){return t.loading?d("div.spinner.small"):d("a",f("chevron-down"))},click:function(){var e=this.state;if(!e.loading)return e.loading=!0,this.sendWidgetAction("loadMore")["finally"](function(){return e.loading=!1})}}),p("discourse-poll-voters",{tagName:"ul.poll-voters-list",buildKey:function(e){return e.id()},defaultState:function(){return{loaded:"new",pollVoters:[],offset:0,canLoadMore:!1}},fetchVoters:function(){var e=this,t=this.attrs,o=this.state;if("loading"!==o.loaded){var s=t.voterIds;if(s.length){var n=Math.round($(".poll-container:eq(0)").width()/25*2),l=o.offset*n,i=s.slice(l,l+n);return o.loaded="loading",m("/polls/voters.json",{type:"get",data:{user_ids:i}}).then(function(s){o.loaded="loaded",o.pollVoters=o.pollVoters.concat(s.users),o.canLoadMore=o.pollVoters.length<t.totalVotes,e.scheduleRerender()})["catch"](function(){bootbox.alert(I18n.t("poll.error_while_fetching_voters"))})}}},loadMore:function(){return this.state.offset+=1,this.fetchVoters()},html:function(e,t){if("new"===t.loaded)return void this.fetchVoters();var o=t.pollVoters.map(function(e){return d("li",[g("tiny",{username:e.username,template:e.avatar_template})," "])});return t.canLoadMore&&o.push(this.attach("discourse-poll-load-more",{id:e.id()})),d("div.poll-voters",o)}}),p("discourse-poll-standard-results",{tagName:"ul.results",html:function(e){var t=this,o=e.poll,s=o.get("options");if(s){var n=function(){var n=o.get("voters"),l=s.sort(function(e,t){return e.votes<t.votes?1:e.votes===t.votes?e.html<t.html?-1:1:-1}),i=0===n?Array(l.length).fill(0):l.map(function(e){return 100*e.votes/n}),r=e.isMultiple?i.map(Math.floor):v(i);return{v:l.map(function(e,s){var n=[],l=r[s].toString();return n.push(d("div.option",d("p",[d("span.percentage",l+"%"),c(e)]))),n.push(d("div.bar-back",d("div.bar",{attributes:{style:"width:"+l+"%"}}))),o.get("public")&&n.push(t.attach("discourse-poll-voters",{id:function(){return"poll-voters-"+e.id},totalVotes:e.votes,voterIds:e.voter_ids})),d("li",n)})}}();if("object"==typeof n)return n.v}}}),p("discourse-poll-number-results",{html:function(e){var t=e.poll,o=t.get("options").reduce(function(e,t){return e+parseInt(t.html,10)*parseInt(t.votes,10)},0),s=t.voters,n=0===s?0:b(o/s,-2),l=I18n.t("poll.average_rating",{average:n}),i=[d("div.poll-results-number-rating",new h({html:"<span>"+l+"</span>"}))];if(t.get("public")){var r,a=t.get("options");i.push(this.attach("discourse-poll-voters",{id:function(){return"poll-voters-"+t.get("name")},totalVotes:t.get("voters"),voterIds:(r=[]).concat.apply(r,u(a.map(function(e){return e.voter_ids})))}))}return i}}),p("discourse-poll-container",{tagName:"div.poll-container",html:function(e){var t=this,o=e.poll;if(e.showResults){var s="number"===o.get("type")?"number":"standard";return this.attach("discourse-poll-"+s+"-results",e)}var n=o.get("options");return n?d("ul",n.map(function(o){return t.attach("discourse-poll-option",{option:o,isMultiple:e.isMultiple,vote:e.vote})})):void 0}}),p("discourse-poll-info",{tagName:"div.poll-info",multipleHelpText:function(e,t,o){if(t>0)if(e===t){if(e>1)return I18n.t("poll.multiple.help.x_options",{count:e})}else{if(e>1)return o>t?I18n.t("poll.multiple.help.between_min_and_max_options",{min:e,max:t}):I18n.t("poll.multiple.help.at_least_min_options",{count:e});if(o>=t)return I18n.t("poll.multiple.help.up_to_max_options",{count:t})}},html:function(e){var t=e.poll,o=t.get("voters"),s=[d("p",[d("span.info-number",o.toString()),d("span.info-text",I18n.t("poll.voters",{count:o}))])];if(e.isMultiple)if(e.showResults){var n=t.get("options").reduce(function(e,t){return e+parseInt(t.votes,10)},0);s.push(d("p",[d("span.info-number",n.toString()),d("span.info-text",I18n.t("poll.total_votes",{count:n}))]))}else{var l=this.multipleHelpText(e.min,e.max,t.get("options.length"));l&&s.push(new h({html:"<span>"+l+"</span>"}))}return!e.showResults&&e.poll.get("public")&&s.push(d("p",I18n.t("poll.public.title"))),s}}),p("discourse-poll-buttons",{tagName:"div.poll-buttons",html:function(e){var t=[],o=e.poll,s=e.post,n=s.get("topic.archived"),l="closed"===o.get("status"),i=l||n;if(e.isMultiple&&!i){var r=!e.canCastVotes;t.push(this.attach("button",{className:"btn cast-votes "+(r?"":"btn-primary"),label:"poll.cast-votes.label",title:"poll.cast-votes.title",disabled:r,action:"castVotes"})),t.push(" ")}return e.showResults?t.push(this.attach("button",{className:"btn toggle-results",label:"poll.hide-results.label",title:"poll.hide-results.title",icon:"eye-slash",disabled:i,action:"toggleResults"})):t.push(this.attach("button",{className:"btn toggle-results",label:"poll.show-results.label",title:"poll.show-results.title",icon:"eye",disabled:0===o.get("voters"),action:"toggleResults"})),!this.currentUser||this.currentUser.get("id")!==s.get("user_id")&&!this.currentUser.get("staff")||n||(l?t.push(this.attach("button",{className:"btn toggle-status",label:"poll.open.label",title:"poll.open.title",icon:"unlock-alt",action:"toggleStatus"})):t.push(this.attach("button",{className:"btn toggle-status btn-danger",label:"poll.close.label",title:"poll.close.title",icon:"lock",action:"toggleStatus"}))),t}}),a["default"]=p("discourse-poll",{tagName:"div.poll",buildKey:function(e){return e.id},buildAttributes:function(e){var t=e.poll;return{"data-poll-type":t.get("type"),"data-poll-name":t.get("name"),"data-poll-status":t.get("status"),"data-poll-public":t.get("public")}},defaultState:function(e){var t=e.poll,o=e.post;return{loading:!1,showResults:t.get("isClosed")||o.get("topic.archived")}},html:function(e,t){var o=t.showResults,s=jQuery.extend({},e,{showResults:o,canCastVotes:this.canCastVotes(),min:this.min(),max:this.max()});return d("div",[this.attach("discourse-poll-container",s),this.attach("discourse-poll-info",s),this.attach("discourse-poll-buttons",s)])},isClosed:function(){return"closed"===this.attrs.poll.get("status")},min:function(){var e=parseInt(this.attrs.poll.min,10);return(isNaN(e)||1>e)&&(e=1),e},max:function(){var e=parseInt(this.attrs.poll.max,10),t=this.attrs.poll.options.length;return(isNaN(e)||e>t)&&(e=t),e},canCastVotes:function(){var e=this.state,t=this.attrs;if(this.isClosed()||e.showResults||e.loading)return!1;var o=t.vote.length;return t.isMultiple?o>=this.min()&&o<=this.max():o>0},toggleStatus:function(){var e=this,t=this.state,o=this.attrs,s=o.poll,n="closed"===s.get("status");bootbox.confirm(I18n.t(n?"poll.open.confirm":"poll.close.confirm"),I18n.t("no_value"),I18n.t("yes_value"),function(l){l&&!function(){t.loading=!0;var l=n?"open":"closed";m("/polls/toggle_status",{type:"PUT",data:{post_id:o.post.get("id"),poll_name:s.get("name"),status:l}}).then(function(){s.set("status",l),e.scheduleRerender()})["catch"](function(){bootbox.alert(I18n.t("poll.error_while_toggling_status"))})["finally"](function(){t.loading=!1})}()})},toggleResults:function(){this.state.showResults=!this.state.showResults},showLogin:function(){var e=this.register.lookup("route:application");e.send("showLogin")},toggleOption:function(e){if(!this.isClosed()){this.currentUser||this.showLogin();var t=this.attrs,o=t.vote,s=o.indexOf(e.id);return t.isMultiple||(o.length=0),-1!==s?o.splice(s,1):o.push(e.id),t.isMultiple?void 0:this.castVotes()}},castVotes:function(){if(this.canCastVotes()){if(!this.currentUser)return this.showLogin();var e=this.attrs,t=this.state;return t.loading=!0,m("/polls/vote",{type:"PUT",data:{post_id:e.post.id,poll_name:e.poll.name,options:e.vote}}).then(function(){t.showResults=!0})["catch"](function(){bootbox.alert(I18n.t("poll.error_while_casting_votes"))})["finally"](function(){t.loading=!1})}}})}),define("discourse/plugins/poll/initializers/extend-for-poll",["discourse/lib/plugin-api","ember-addons/ember-computed-decorators","discourse-common/lib/get-owner","discourse/widgets/glue","exports"],function(e,t,o,s,n){"use strict";function l(e){for(var t={},o=0;o<e.length;o++){var s=e[o],n=s.decorators,l=s.key;if(delete s.key,delete s.decorators,s.enumerable=!0,s.configurable=!0,("value"in s||s.initializer)&&(s.writable=!0),n)for(var i=0;i<n.length;i++){var r=n[i];if("function"!=typeof r)throw new TypeError("The decorator for method "+s.key+" is of the invalid type "+typeof r);s=r(t,l,s)||s}s.initializer&&(s.value=s.initializer.call(t)),Object.defineProperty(t,l,s)}return t}function i(e){function t(t,o){var n=$(".poll",t);if(n.length){var l=o.getModel();e.preventCloak(l.id);var i=l.get("polls_votes")||{};l.pollsChanged();var a=l.get("pollsObject");a&&n.each(function(e,t){var o=$(t),n=o.data("poll-name"),u=a[n];if(u){var p="multiple"===u.get("type"),d=new c("discourse-poll",s,{id:n+"-"+l.id,post:l,poll:u,vote:i[n]||[],isMultiple:p});d.appendTo(t),r.push(d)}})}}function o(){r.forEach(function(e){return e.cleanUp()})}var s=u(e),n=e.container.lookupFactory("controller:topic");n.reopen({subscribe:function(){var e=this;this._super(),this.messageBus.subscribe("/polls/"+this.get("model.id"),function(t){var o=e.get("model.postStream").findLoadedPost(t.post_id);o&&o.set("polls",t.polls)})},unsubscribe:function(){this.messageBus.unsubscribe("/polls/*"),this._super()}});var i=e.container.lookupFactory("model:post");i.reopen(l([{key:"_polls",initializer:function(){return null}},{key:"pollsObject",initializer:function(){return null}},{key:"pollsChanged",decorators:[a("polls")],value:function(){var e=this,t=this.get("polls");t&&(this._polls=this._polls||{},_.map(t,function(t,o){var s=e._polls[o];s?e._polls[o].setProperties(t):e._polls[o]=Em.Object.create(t)}),this.set("pollsObject",this._polls))}}]));var r=[];e.includePostAttributes("polls","polls_votes"),e.decorateCooked(t,{onlyStream:!0}),e.cleanupStream(o)}var r=e.withPluginApi,a=t.observes,u=o.getRegister,c=s["default"];n["default"]={name:"extend-for-poll",initialize:function(){r("0.1",i)}}}),define("discourse/plugins/poll/initializers/add-poll-ui-builder",["discourse/lib/plugin-api","discourse/lib/show-modal","exports"],function(e,t,o){"use strict";function s(e){var t=e.container.lookup("site-settings:main");if(t.poll_enabled||!e.getCurrentUser()||e.getCurrentUser().staff){var o=e.container.lookupFactory("controller:composer");o.reopen({actions:{showPollBuilder:function(){l("poll-ui-builder").set("toolbarEvent",this.get("toolbarEvent"))}}}),e.addToolbarPopupMenuOptionsCallback(function(){return{action:"showPollBuilder",icon:"bar-chart-o",label:"poll.ui_builder.title"}})}}var n=e.withPluginApi,l=t["default"];o["default"]={name:"add-poll-ui-builder",initialize:function(){n("0.5",s)}}});
//# sourceMappingURL=/assets/plugin-7912cc75b45557130d5fc5634e35b89fd2bf80e4aa6171ddd256f99378da015d.js.map